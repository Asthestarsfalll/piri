# Autofill 插件

Autofill 插件会在窗口关闭或布局改变时，自动将最后一列窗口对齐到最右侧位置。这有助于保持整洁有序的窗口布局，防止关闭窗口后在工作区中留下空隙。

## 演示视频

![Autofill 演示视频](../assets/autofill.mp4)

![Autofill 演示视频 1](../assets/autofill_1.mp4)

![Autofill 演示视频 2](../assets/autofill_2.mp4)

## 配置

Autofill 插件不需要额外的配置。只需在配置文件中启用它：

```toml
[piri.plugins]
autofill = true
```

## 工作原理

Autofill 插件使用**纯事件驱动**的方法实时监听 niri 合成器事件：

1. **事件流监听**: 插件通过 niri IPC 的 `EventStream` 监听窗口事件
2. **实时响应**: 当接收到 `WindowClosed` 或 `WindowLayoutsChanged` 事件时，立即对齐当前工作区中的列
3. **自动对齐**: 通过使用 niri 的列导航命令（先执行 `focus-column-first`，然后执行 `focus-column-last`）将列对齐到最右侧位置

## 对齐算法

当窗口关闭或布局改变时，插件会：

1. **保存当前聚焦的窗口** - 保留用户当前的聚焦状态
2. **聚焦第一列** - 聚焦当前工作区中的第一列
3. **聚焦最后一列** - 聚焦当前工作区中的最后一列（这将使其对齐到最右侧位置）
4. **恢复聚焦** - 恢复聚焦到之前聚焦的窗口（如果存在）

这种方法确保了关闭窗口后，剩余的窗口会自动调整以填充空间，同时保持用户原有的聚焦状态，保持工作区整洁有序且不打断工作流程。

## 特性

- ✅ **纯事件驱动**: 使用 niri 事件流进行实时监听，在窗口关闭时自动处理布局变化
- ✅ **零配置**: 开箱即用，无需配置
- ✅ **简单高效**: 直接对齐列，无需复杂的窗口检测逻辑
- ✅ **聚焦保持**: 自动保存和恢复用户聚焦的窗口，确保不打断工作流程
- ✅ **工作区感知**: 仅影响发生变化的当前工作区中的列
- ✅ **自动重连**: 连接丢失时自动重连，确保持续服务

## 使用方法

只需在配置文件中启用插件：

```toml
[piri.plugins]
autofill = true
```

然后重启或重新加载守护进程：

```bash
# 重启守护进程
piri daemon

# 或者如果守护进程已在运行，重新加载配置
piri reload
```

插件会自动在后台开始工作。无需命令或手动干预！

## 使用场景

- **整洁的工作区管理**: 在关闭窗口后自动保持整洁的窗口布局
- **多列布局**: 保持多列窗口布局的有序和对齐
- **提高生产力**: 专注于工作，而不是手动重新排列窗口

## 注意事项

1. **基于工作区**: 插件在发生事件的当前工作区中操作
2. **聚焦保持**: 在执行对齐操作之前，插件会保存当前聚焦的窗口。对齐完成后，会恢复聚焦到该窗口，确保工作流程不被中断
3. **简单操作**: 插件聚焦第一列然后聚焦最后一列，这会自动将所有列对齐到最右侧位置
4. **实时处理**: 对齐会在窗口关闭或布局改变时立即发生，确保响应迅速
