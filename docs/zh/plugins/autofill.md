# Autofill 插件

Autofill 插件会在窗口关闭或布局改变时，自动将最后一列窗口对齐到最右侧位置。这有助于保持整洁有序的窗口布局，防止关闭窗口后在工作区中留下空隙。

## 演示视频

![Autofill 演示视频](../assets/autofill.mp4)

## 配置

Autofill 插件不需要额外的配置。只需在配置文件中启用它：

```toml
[piri.plugins]
autofill = true
```

## 工作原理

Autofill 插件使用**纯事件驱动**的方法实时监听 niri 合成器事件：

1. **事件流监听**: 插件通过 niri IPC 的 `EventStream` 监听窗口事件
2. **实时响应**: 当接收到 `WindowClosed` 或 `WindowLayoutsChanged` 事件时，立即检查当前工作区布局
3. **最后一列检测**: 识别当前工作区中的最后一列（最右侧的列）
4. **自动对齐**: 通过使用 niri 的列导航命令将最后一列对齐到最右侧位置

## 对齐算法

当窗口关闭或布局改变时，插件会：

1. 获取当前聚焦的窗口以确定工作区
2. 筛选当前工作区中所有非浮动窗口
3. 找到最后一列中的窗口（列号最大的窗口）
4. 聚焦该窗口
5. 将焦点移动到左侧列（确保我们不在边缘）
6. 将焦点移回右侧列（这将使其对齐到最右侧位置）

这确保了关闭窗口后，剩余的窗口会自动调整以填充空间，保持工作区整洁有序。

## 特性

- ✅ **纯事件驱动**: 使用 niri 事件流进行实时监听，在窗口关闭时自动处理布局变化
- ✅ **零配置**: 开箱即用，无需配置
- ✅ **智能检测**: 自动检测何时需要对齐最后一列
- ✅ **工作区感知**: 仅影响发生变化的当前工作区中的窗口
- ✅ **浮动窗口感知**: 忽略浮动窗口，仅对齐平铺窗口
- ✅ **自动重连**: 连接丢失时自动重连，确保持续服务

## 使用方法

只需在配置文件中启用插件：

```toml
[piri.plugins]
autofill = true
```

然后重启或重新加载守护进程：

```bash
# 重启守护进程
piri daemon

# 或者如果守护进程已在运行，重新加载配置
piri reload
```

插件会自动在后台开始工作。无需命令或手动干预！

## 使用场景

- **整洁的工作区管理**: 在关闭窗口后自动保持整洁的窗口布局
- **多列布局**: 保持多列窗口布局的有序和对齐
- **提高生产力**: 专注于工作，而不是手动重新排列窗口

## 注意事项

1. **浮动窗口**: 浮动窗口会被插件忽略 - 仅影响平铺窗口
2. **单个窗口**: 如果工作区中只有一个窗口，会跳过对齐（无需对齐）
3. **无需聚焦**: 插件会根据需要对窗口进行聚焦以实现对齐，你无需手动聚焦最后一列
4. **实时处理**: 对齐会在窗口关闭或布局改变时立即发生，确保响应迅速
