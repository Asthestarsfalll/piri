# Window Order 插件

Window Order 插件根据配置的权重值自动重排工作区中的窗口顺序，权重值越大窗口越靠左。

## 配置

```toml
[piri.plugins]
window_order = true

[piri.window_order]
enable_event_listener = true  # 启用事件监听，自动重排
default_weight = 0           # 未配置窗口的默认权重
# workspaces = ["1", "2", "dev"]  # 可选：仅在指定工作区应用（空列表 = 所有工作区）

[window_order]
google-chrome = 100
code = 80
ghostty = 70
```

### 配置选项

- `enable_event_listener`: 是否启用事件监听。启用后，窗口布局改变或新窗口打开时会自动重排（仅在配置的 `workspaces` 中生效）
- `default_weight`: 未在 `[window_order]` 中配置的窗口的默认权重值
- `workspaces`: 可选，指定在哪些工作区应用窗口排序。可以是工作区名称或索引（字符串数组）。如果为空或不指定，则应用到所有工作区
- `[window_order]`: 窗口权重配置表，键为窗口的 `app_id`，值为权重（数值越大越靠左）

### 权重匹配规则

插件支持部分匹配：

- 配置 `ghostty = 70` 可以匹配 `com.mitchellh.ghostty`
- 配置 `google-chrome = 100` 可以匹配 `google-chrome-stable`

匹配优先级：

1. 精确匹配
2. 配置键包含在 `app_id` 中
3. `app_id` 包含在配置键中
4. 如果都不匹配，使用 `default_weight`

## 使用方法

### 手动触发

```bash
piri window_order toggle
```

**注意**：手动触发可以在任意工作区执行，不受 `workspaces` 配置限制。

![Window Order - 手动触发](../../assets/window_order.mp4)

### 自动触发

如果启用了 `enable_event_listener`，插件会在以下情况下自动重排：

- 窗口布局改变时（`WindowLayoutsChanged` 事件）
- 新窗口打开时（`WindowOpenedOrChanged` 事件）

**注意**：自动触发仅在配置的 `workspaces` 列表中执行。如果未配置 `workspaces` 或列表为空，则应用到所有工作区。

![Window Order - 事件监听自动触发](../../assets/window_order_envent.mp4)

## 工作原理

插件使用智能算法最小化窗口移动次数：

1. 获取当前工作区中所有平铺窗口的列位置
2. 根据配置的权重值计算每个窗口的目标位置
3. 使用贪心算法找到移动次数最少的方案
4. 依次移动窗口到目标位置

### 算法特性

- **最小化移动次数**: 优先选择能让最多窗口到达正确位置的移动
- **最小化移动距离**: 在移动次数相同的情况下，选择移动距离最小的方案
- **优先移动聚焦窗口**: 如果只需要移动一个窗口，优先移动当前聚焦的窗口
- **保持相同权重窗口的相对顺序**: 相同权重的窗口保持当前相对顺序

## 特性

- ✅ **智能排序**: 根据配置的权重值自动排序窗口
- ✅ **最小化移动**: 使用优化算法减少窗口移动次数
- ✅ **部分匹配**: 支持 `app_id` 的部分匹配
- ✅ **事件驱动**: 可选的自动重排功能
- ✅ **聚焦保持**: 移动后恢复原始聚焦窗口
- ✅ **稳定排序**: 相同权重窗口保持相对顺序

## 使用场景

- 将常用应用（如浏览器、编辑器）固定在工作区左侧
- 在多个相同应用窗口时，保持它们的相对顺序
- 通过事件监听自动维护窗口顺序

## 注意事项

1. **仅处理平铺窗口**: 浮动窗口不会被重排
2. **工作区过滤**:
   - **手动触发**：可以在任意工作区执行，不受 `workspaces` 配置限制
   - **自动触发**：仅在配置的 `workspaces` 列表中执行。如果未配置或为空，则应用到所有工作区
3. **权重值越大越靠左**: 权重值 100 的窗口会在权重值 80 的窗口左侧
4. **相同权重保持顺序**: 相同权重的窗口不会改变相对顺序，以减少不必要的移动
5. **工作区匹配**: `workspaces` 支持工作区名称或索引（字符串格式），例如 `["1", "2", "dev"]`
